<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>nepobabiesruntheunderground</title>
  <link rel="stylesheet" href="styles.css">

  <!-- html2canvas for snapshotting just the .parallax-bg -->
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
  <!-- 1) Your fixed parallax layer -->
  <div class="parallax-bg"></div>

  <!-- 2) The pixel-canvas sits immediately above it -->
  <canvas id="pixel-canvas"></canvas>

  <!-- 3) The overlay and rest of your content remain as before -->
  <div class="pillsieat-overlay"></div>
  <img src="nepobabiesruntheundergroundlogo.png" class="logo" alt="Logo">

  <main>
    <div>
      <p>i dont need anything</p><p>i dont need anything</p>
      <p>i dont need anything</p><p>i dont need anything</p>
      <p>i dont need anything</p><p>i dont need anything</p>
    </div>
    <div id="flashing-div">
      <p style="font-size:2.5em;">fuck</p>
      <p style="font-size:2.5em;">you</p>
      <p style="font-size:2.5em;">slut</p>
    </div>
  </main>

  <footer>
    <p>&copy; 2023 nepobabiesruntheunderground. All rights reserved.</p>
  </footer>

  <!-- flashing-div script (unchanged) -->
  <script>
    const flashingDiv = document.getElementById('flashing-div');
    function randomBW() {
      const shade = Math.floor(Math.random() * 256);
      flashingDiv.style.color = shade > 128 ? 'black' : 'white';
    }
    setInterval(randomBW, 20);
  </script>

  <!-- pixelation script targeting only .parallax-bg -->
  <script>
    const pixelCanvas = document.getElementById('pixel-canvas');
    const pCtx        = pixelCanvas.getContext('2d');
    const PIXEL_SCALE = 0.5;  // 10% resolution â†’ larger blocks

    function resizeCanvas() {
      pixelCanvas.width  = window.innerWidth;
      pixelCanvas.height = window.innerHeight;
    }

    async function updateParallaxPixelation() {
      // snapshot ONLY the .parallax-bg element at low res
      const snap = await html2canvas(
        document.querySelector('.parallax-bg'),
        {
          scale: PIXEL_SCALE,
          backgroundColor: null,
          useCORS: true,
          allowTaint: true,
          logging: false
        }
      );

      // draw it back up full-screen without smoothing
      pixelCanvas.style.display = '';
      pCtx.imageSmoothingEnabled = false;
      pCtx.clearRect(0, 0, pixelCanvas.width, pixelCanvas.height);
      pCtx.drawImage(
        snap,
        0, 0,
        snap.width, snap.height,
        0, 0,
        pixelCanvas.width, pixelCanvas.height
      );
    }

    // wire up
    window.addEventListener('load', () => {
      resizeCanvas();
      updateParallaxPixelation();
    });
    window.addEventListener('resize', () => {
      resizeCanvas();
      updateParallaxPixelation();
    });
    window.addEventListener('scroll', updateParallaxPixelation);
  </script>
</body>
</html>
